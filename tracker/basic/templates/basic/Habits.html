{% extends 'base.html' %}

{% block content %}
<div class="habits-list">
    {% for habit in habits %}
    {% with status=habit.statuses.all|dictsort:"date"|last %}
    <!-- Класс habit-completed должен быть на ОСНОВНОМ блоке .habit-item -->
    <div class="habit-item {% if status.is_completed %}habit-completed{% endif %}
        {% if habit.goal.general_goal.theme == 'Здоровье' %}habit-health
        {% elif habit.goal.general_goal.theme == 'Программирование' %}habit-programming
        {% endif %}">

        <!-- Форма для отметки статуса привычки -->
<form action="{% url 'habitstatus_update' habit.today_status.id %}" method="post" style="display:inline;">
    {% csrf_token %}

    <button type="submit" class="habit-status-btn">
        <!-- Добавляем классы в зависимости от статуса -->
        <div class="habit-item {% if habit.today_status.is_completed %}completed{% else %}active{% endif %}">

            <!-- Название и статистика -->
            <div class="habit-header">
                <span class="habit-name">{{ habit.name }}</span>
                <span class="habit-stats">({{ habit.completed_days }}/{{ habit.total_days }})</span>
            </div>

            <!-- Прогресс-бар -->
            <div class="progress-bar full-width">
                <div class="progress-fill
                    {% if habit.progress >= 80 %}progress-high
                    {% elif habit.progress >= 50 %}progress-medium
                    {% else %}progress-low
                    {% endif %}"
                    style="width: {{ habit.progress }}%;">
                </div>
            </div>

            <!-- Небольшая иконка статуса -->
            <div class="status-indicator">
                {% if habit.today_status.is_completed %}
                    ✅ Выполнено
                {% else %}
                    ⏳ Ожидает
                {% endif %}
            </div>

        </div>
    </button>
</form>
    </div>
    {% endwith %}
    {% endfor %}
</div>
{% if is_paginated %}
<div class="pagination">
  {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}" class="page-btn">Prev</a>
  {% endif %}

  <span class="page-info">{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>

  {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}" class="page-btn">Next</a>
  {% endif %}
</div>
{% endif %}
<a href="{% url 'add_habit' %}">Создать привычку</a>
{% endblock %}